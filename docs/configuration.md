# Configuration Guide

This guide covers all configuration options for the vite-plugin-vue-i18n-typescript plugin.

## Basic Configuration

The plugin works with zero configuration, but you can customize its behavior:

```typescript
// vite.config.ts
import i18nTypes from 'vite-plugin-vue-i18n-typescript'

export default defineConfig({
  plugins: [
    i18nTypes({
      // Your options here
      baseLocale: 'en'
    })
  ]
})
```

## Configuration Options

### File Discovery

#### `include`

- **Type:** `string | string[]`
- **Default:** `['./**/locales/*.json', './**/*.vue.*.json', './**/*<baseLocale>.json']`
- **Description:** Glob patterns for finding locale files

```typescript
i18nTypes({
  include: [
    'src/locales/**/*.json',
    'src/modules/**/i18n/*.json'
  ]
})
```

#### `exclude`

- **Type:** `string | string[]`
- **Default:** `['**/tsconfig.*', '**/node_modules/**', '**/.git/**', '**/dist/**', '**/.output/**', '**/.vercel/**', '**/.next/**', '**/build/**']`
- **Description:** Glob patterns to exclude from scanning

```typescript
i18nTypes({
  exclude: ['**/*.test.json', '**/temp/**']
})
```

#### `getLocaleFromPath`

- **Type:** `(absPath: string, root: string) => string | null`
- **Default:** Extracts from filename (e.g., `en.json` â†’ `en`)
- **Description:** Custom function to extract locale code from file path

```typescript
i18nTypes({
  getLocaleFromPath: (absPath, root) => {
    // Custom extraction logic
    const filename = path.basename(absPath)
    if (filename.startsWith('messages.')) {
      return filename.split('.')[1] // messages.en.json -> en
    }
    return null
  }
})
```

### Output Configuration

#### `typesPath`

- **Type:** `string`
- **Default:** `'./src/vite-env-override.d.ts'`
- **Description:** Path for generated TypeScript type definitions

```typescript
i18nTypes({
  typesPath: 'src/types/i18n-generated.d.ts'
})
```

#### `virtualFilePath`

- **Type:** `string`
- **Default:** `undefined`
- **Description:** Optional path to generate virtual module as physical file (for debugging)

```typescript
i18nTypes({
  virtualFilePath: 'src/i18n/debug.gen.ts'
})
```

#### `banner`

- **Type:** `string`
- **Default:** Auto-generated header with content hash
- **Description:** Custom header comment for generated files

```typescript
i18nTypes({
  banner: `
    // Generated by My Build System
    // Do not edit manually
    // Last updated: ${new Date().toISOString()}
  `
})
```

### Locale Configuration

#### `baseLocale`

- **Type:** `string`
- **Default:** `'de'`
- **Description:** Primary locale used for type generation

```typescript
i18nTypes({
  baseLocale: 'en' // Use English as base
})
```

#### `merge`

- **Type:** `'deep' | 'shallow'`
- **Default:** `'deep'`
- **Description:** How to merge multiple locale files for the same language

```typescript
i18nTypes({
  merge: 'shallow' // Only merge top-level keys
})
```

**Deep merge example:**

```javascript
// File 1: en/common.json
{ "nav": { "home": "Home" } }

// File 2: en/auth.json
{ "nav": { "login": "Login" } }

// Result with deep merge:
{ "nav": { "home": "Home", "login": "Login" } }
```

**Shallow merge example:**

```javascript
// Result with shallow merge:
{ "nav": { "login": "Login" } } // nav from File 2 overwrites File 1
```

### Virtual Module Configuration

#### `sourceId`

- **Type:** `string`
- **Default:** `'virtual:vue-i18n-types'`
- **Description:** Virtual module ID used for runtime imports and generated type definitions

```typescript
i18nTypes({
  sourceId: 'virtual:my-i18n'
})

// Then import as:
import messages from 'virtual:my-i18n/messages'
```


### Runtime Options

#### `emit`

- **Type:** `{ fileName?: string; inlineDataInBuild?: boolean; emitJson?: boolean }`
- **Default:** `{ fileName: 'assets/locales.json', inlineDataInBuild: false, emitJson: false }`
- **Description:** Asset emission configuration for build

```typescript
i18nTypes({
  emit: {
    fileName: 'i18n-messages.json',
    inlineDataInBuild: true,   // Embed in bundle instead of separate file
    emitJson: true             // Emit physical JSON asset alongside build output
  }
})
```

### Development Options

#### `debug`

- **Type:** `boolean`
- **Default:** `false`
- **Description:** Enable detailed debug logging

```typescript
i18nTypes({
  debug: true // Show detailed logs
})
```

#### `transformJson`

- **Type:** `(json: unknown, absPath: string) => unknown`
- **Default:** `undefined`
- **Description:** Transform JSON data before processing

```typescript
i18nTypes({
  transformJson: (json, filePath) => {
    // Remove all keys starting with underscore
    const clean = {}
    for (const [key, value] of Object.entries(json)) {
      if (!key.startsWith('_')) {
        clean[key] = value
      }
    }
    return clean
  }
})
```

## Complete Configuration Example

```typescript
/// <reference types="./vite-env-override" />
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import i18nTypes from 'vite-plugin-vue-i18n-typescript'
import path from 'path'

export default defineConfig({
  plugins: [
    vue(),
    i18nTypes({
      // File Discovery
      include: [
        'src/locales/**/*.json',
        'src/modules/**/i18n/*.json',
        'translations/**/*.json'
      ],
      exclude: [
        '**/*.test.json',
        '**/drafts/**'
      ],

      // Output Paths
      typesPath: 'src/types/i18n.gen.d.ts',
      virtualFilePath: process.env.DEBUG ? 'src/debug/i18n.gen.ts' : undefined,

      // Locales
      baseLocale: 'en',
      merge: 'deep',

      // Virtual Module
      sourceId: 'virtual:i18n-messages',

      // Runtime
      emit: {
        fileName: 'locales.json',
        inlineDataInBuild: false,
        emitJson: true
      },

      // Custom Functions
      getLocaleFromPath: (absPath, root) => {
        const rel = path.relative(root, absPath)
        const match = rel.match(/locales\/(\w+)\//)
        return match ? match[1] : null
      },

      transformJson: (json, filePath) => {
        // Add source file info
        return {
          ...json,
          _source: path.basename(filePath)
        }
      },

      // Development
      debug: process.env.DEBUG === 'true',
      banner: '// Generated i18n types - Do not edit!'
    })
  ]
})
```

## File Structure Support

### Flat Structure

```
src/locales/
  en.json
  de.json
  fr.json
```

Configuration:

```typescript
i18nTypes({
  include: ['src/locales/*.json']
})
```

### Nested by Language

```
src/locales/
  en/
    common.json
    errors.json
  de/
    common.json
    errors.json
```

Configuration:

```typescript
i18nTypes({
  include: ['src/locales/**/*.json'],
  getLocaleFromPath: (path) => {
    // Extract from directory name
    const match = path.match(/locales\/(\w+)\//)
    return match ? match[1] : null
  }
})
```

### Module-based Structure

```
src/
  modules/
    auth/
      i18n/
        en.json
        de.json
    dashboard/
      i18n/
        en.json
        de.json
```

Configuration:

```typescript
i18nTypes({
  include: ['src/modules/**/i18n/*.json']
})
```

## Performance Tuning

### For Large Projects

```typescript
i18nTypes({
  // Exclude unnecessary files
  exclude: [
    '**/*.backup.json',
    '**/archive/**',
    '**/_old/**'
  ],

  // Use shallow merge if deep nesting isn't needed
  merge: 'shallow',

  // Disable debug in production
  debug: process.env.NODE_ENV !== 'production'
})
```

### For Monorepos

```typescript
i18nTypes({
  // Scope to specific package
  root: './packages/app',
  include: ['src/locales/**/*.json'],

  // Use package-specific paths
  typesPath: 'src/types/i18n.d.ts',
  sourceId: 'virtual:app-i18n'
})
```

## TypeScript Setup

Add the reference directive at the top of your `vite.config.ts`:

```typescript
/// <reference types="./vite-env-override" />
```

This ensures TypeScript recognizes the generated type definitions.

## Troubleshooting

### Types Not Generating

Check your configuration:

```typescript
i18nTypes({
  debug: true, // Enable debug logs
  verbose: true // Show detailed output
})
```

### Wrong Locale Detection

Implement custom extraction:

```typescript
i18nTypes({
  getLocaleFromPath: (absPath) => {
    console.log('Processing:', absPath)
    // Your custom logic
    return locale
  }
})
```

### Virtual Module Not Found

Ensure the import matches your configuration:

```typescript
// If using a custom module ID:
i18nTypes({
  sourceId: 'virtual:my-custom-i18n'
})

// Import must match:
import messages from 'virtual:my-custom-i18n/messages'
```
